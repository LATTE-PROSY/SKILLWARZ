try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},r=(new e.Error).stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="f51fedf6-5588-4684-b7ff-b182c2d7a23a",e._sentryDebugIdIdentifier="sentry-dbid-f51fedf6-5588-4684-b7ff-b182c2d7a23a")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:crazygames-portal":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[77317],{53164:(e,r,t)=>{t.d(r,{R:()=>a});var s=t(96540),n=t(9020);let a=e=>{let{game:r}=e,{setPlayingGame:t,resetGameInvites:a,setGameInviteLink:l}=s.useContext(n.Tz);return s.useEffect(()=>{if(r)return t(r),()=>{t(null),l(null),a()}},[r,a,l,t]),null}},68044:(e,r,t)=>{t.d(r,{u:()=>s,y:()=>n});let s="game-iframe";function n(){return document.getElementById(s)}},38037:(e,r,t)=>{t.d(r,{A:()=>l});var s=t(74848),n=t(96540),a=t(64996);let l=function(e){return r=>{let{services:t}=n.useContext(a.A);return(0,s.jsx)(e,{services:t,...r})}}},71197:(e,r,t)=>{t.d(r,{A:()=>p});var s=t(96540),n=t(95420),a=t(18081),l=t(341),o=t(12896),i=t(59386),u=t(8056),c=t(40499),d=t(22672);async function f(e){let r=await fetch(e,{method:"GET"});return await r.text()}let p=e=>{let{gameId:r,gameTechnology:t}=e,{user:p}=s.useContext(i.R),m=s.useContext(u.A),[h]=(0,n.n)(d.P),[g]=(0,n.n)(d.kL),[w,k]=(0,a._)(d.IJ,{fetchPolicy:"network-only"}),y=s.useRef([]);return s.useEffect(()=>{if(!k.called||k.loading)return;let e=k.data?.gameData;k.error?(y.current.forEach(e=>{e({type:"requestGameDataNone"})}),y.current=[]):e&&e.dataUrl?f(e.dataUrl).then(r=>{let t={...e,data:r};y.current.forEach(e=>{e({type:"requestGameDataResponse",data:{store:t,error:k.error}})}),y.current=[]}):(y.current.forEach(e=>{e({type:"requestGameDataResponse",data:{store:void 0,error:k.error}})}),y.current=[])},[k]),s.useEffect(()=>{let e=e=>{p?(y.current=[r=>{let t=e.source;t&&t.postMessage(r,"*")},...y.current],w({variables:{id:r,technology:t}})):y.current.forEach(e=>{e({type:"requestGameDataResponse",data:{store:void 0,error:null}})})},s=e=>{let{store:s,version:n,updatedAtTz:a,playedTime:l}=e.data,o=JSON.stringify(s);h({variables:{input:{data:o,id:r,technology:t,version:n,browser:m.browser?.name||"",playedTime:l,deviceType:(0,c.mO)(m.deviceType),updatedAtTz:a}}})},n=e=>{let{version:s}=e.data;g({variables:{input:{id:r,technology:t,version:s,browser:m.browser?.name||"",deviceType:(0,c.mO)(m.deviceType)}}})},a=r=>{if(r.data&&r.data.type===l.x)switch(r.data.event){case"requestGameData":e(r);break;case"updateGameData":case"replaceGameData":(0,o.isDefined)(p)&&s(r);break;case"clearGameData":(0,o.isDefined)(p)&&n(r);break;default:return}};return window.addEventListener("message",a),function(){window.removeEventListener("message",a)}},[h,w,g,r,t,p,m.browser,m.deviceType]),null}},29467:(e,r,t)=>{t.d(r,{A:()=>c});var s=t(96540),n=t(341),a=t(63522),l=t(59386),o=t(45300),i=t(75782),u=t(59785);let c=e=>{let{gameId:r}=e,{user:t}=s.useContext(l.R),{openedDrawer:c}=s.useContext(u.l9),{drawerOpeningPending:d}=s.useContext(u.Cx),{openDrawer:f}=s.useContext(u.lv),{refetch:p,loading:m}=a.ic(),{refetch:h,loading:g}=a.X6(),[w,k]=(0,s.useState)(!1),[y,F]=(0,s.useState)(null),{user:E}=a.Jd();(0,s.useEffect)(()=>{if(!d&&w&&y&&(t||c||(k(!1),F(null),y.postMessage({type:"showAuthPromptResponse",data:{error:{code:"userCancelled",message:"User cancelled the auth prompt"}}},"*")),t&&E&&!c)){k(!1),F(null);let e={type:"showAuthPromptResponse",data:{user:{id:E.id,username:`${E.username}`,profilePictureUrl:`${o.A.Instance.data.images}${E.profile.avatar}`}}};y.postMessage(e,"*")}},[c,w,t,y,E,d]);let v=(0,s.useCallback)(async(e,s)=>{let n={type:"requestUserTokenResponse",data:{}};if(!t){n.data={error:{code:"userNotAuthenticated",message:"The user is not authenticated"}},e.postMessage(n,"*");return}if(m)return;let a=await p({gameId:r,iframeUrl:s}),l=a.data?.userToken;a.error||!l?(console.error("User token retrieve error",a.error),n.data={error:{code:"unexpectedError",message:"Failed to retrieve user token"}}):n.data={token:l.token,expiresIn:l.expiresIn},e.postMessage(n,"*")},[t,m,p,r]),b=(0,s.useCallback)(async e=>{let s={type:"requestXsollaUserTokenResponse",data:{}};if(!t){s.data={error:{code:"userNotAuthenticated",message:"The user is not authenticated"}},e.postMessage(s,"*");return}if(g)return;let n=await h({gameId:r}),a=n.data?.xsollaUserToken;if(n.error||!a){let e,r;console.error("Xsolla user token retrieve error",n.error),(e=>"object"==typeof e&&null!==e&&"graphQLErrors"in e&&Array.isArray(e.graphQLErrors))(n.error)&&n.error.graphQLErrors.length>0&&(e=n.error.graphQLErrors[0]?.extensions?.code,r=n.error.graphQLErrors[0]?.message),e?s.data={error:{code:e,message:r||""}}:s.data={error:{code:"unexpectedError",message:"Failed to retrieve Xsolla user token"}}}else s.data={token:a.token,expiresIn:a.expiresIn};e.postMessage(s,"*")},[r,h,t,g]);return(0,s.useEffect)(()=>{let e=e=>{let r=()=>{setTimeout(()=>{f("signIn"),k(!0),F(e.source),i.A.removeFakeFullscreenListener(r)},100)};i.A.isFakeFullscreen()?i.A.addFakeFullscreenListener(r):(f("signIn"),k(!0),F(e.source))},r=r=>{if(r.data&&r.data.type===n.x)switch(r.data.event){case"requestUserToken":{let e=r.data;v(r.source,e.iframeUrl);break}case"requestXsollaUserToken":b(r.source);break;case"showAuthPrompt":e(r);break;default:return}};return window.addEventListener("message",r),function(){window.removeEventListener("message",r)}},[r,t,f,b,v]),null}},42293:(e,r,t)=>{t.d(r,{A:()=>l});var s=t(74848),n=t(96540),a=t(30804);let l=function(e){return r=>{let t=n.useContext(a.H);return(0,s.jsx)(e,{experiment:t,...r})}}},75782:(e,r,t)=>{t.d(r,{A:()=>n});class s{removeFullscreenListener(e){this.eventKeys.forEach(r=>{document.removeEventListener(r,e)})}addFullscreenListener(e){this.eventKeys.forEach(r=>{document.addEventListener(r,e)})}addFakeFullscreenListener(e){this.fakeFullscreenListeners.push(e)}removeFakeFullscreenListener(e){this.fakeFullscreenListeners=this.fakeFullscreenListeners.filter(r=>r!==e)}isFullscreen(){let e=window.document;return!!(e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement)}isFakeFullscreen(){return this.isInFakeFullscreen}enteredFakeFullscreen(){this.isInFakeFullscreen||(this.isInFakeFullscreen=!0,this.fakeFullscreenListeners.forEach(e=>e()))}exitFakeFullscreen(){this.isInFakeFullscreen&&(this.isInFakeFullscreen=!1,this.fakeFullscreenListeners.forEach(e=>e()))}exitNativeFullscreen(){let e=window.document,r=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen;return!!r&&(window.document.fullscreenElement&&r.call(e),!0)}constructor(){this.fakeFullscreenListeners=[],this.eventKeys=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],this.isInFakeFullscreen=!1,this.forceLockOrientation=async(e,r)=>{if(!r||"BOTH"===r||!("screen"in window)||!window.screen||!window.screen.orientation||!window.screen.orientation.lock)return;let t=null;try{await Promise.race([window.screen.orientation.lock("PORTRAIT"===r?"portrait":"landscape"),new Promise((r,s)=>{t=setTimeout(()=>{e.trackGenericError("timeoutError",{message:"Error in orientation lock timeout"}),s(Error("Orientation lock timeout"))},1e3)})])}catch(e){}finally{t&&clearTimeout(t)}}}}let n=new s},62603:(e,r,t)=>{t.d(r,{A:()=>l});var s=t(74848),n=t(96540),a=t(89737);let l=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return e=>class extends n.Component{static async getInitialProps(t){let{trlService:s}=(0,a.V)(t);if(!t.req){let n=Promise.all(r.map(e=>s.loadTrlMessagesToLingui(e))),[a]=await Promise.all([e.getInitialProps?await e.getInitialProps(t):{},n]);return{...a}}let n=Promise.all(r.map(e=>s.getTrlMessages(e))),[l,o]=await Promise.all([e.getInitialProps?e.getInitialProps(t):Promise.resolve({}),n]);return{messages:o.reduce((e,r)=>Object.assign(e,r)),...l}}render(){let{...r}=this.props;return(0,s.jsx)(e,{...r})}}}}}]);